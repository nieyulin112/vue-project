'use strict'

const path = require('path')
const fs = require('fs')

module.exports.getBabelLoader = function (projectRoot, name) {
  name = name || 'vux'
  if (!projectRoot) {
    projectRoot = path.resolve(__dirname, '../../../')
    if (/\.npm/.test(projectRoot)) {
      projectRoot = path.resolve(projectRoot, '../../../')
    }
  }

  const componentPath = fs.realpathSync(projectRoot + `/node_modules/${name}/`) // https://github.com/webpack/webpack/issues/1643
  const regex = new RegExp(`node_modules.${name}.src.*?js$`)

  return {
    test: /node_modules.*vux.src.*?js$/,
    loader: 'babel',
    include: componentPath
  }
}
